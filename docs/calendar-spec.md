# カレンダービュー機能 仕様書

## 1. 機能概要

技術カンファレンスをカレンダー形式で月別に閲覧できる機能。
日付ごとのイベント開催状況を視覚的に把握し、詳細を確認できる。

**目的**:
- イベントの日程を俯瞰的に把握
- 特定の日に開催されるイベントを素早く確認
- 月単位でのイベント計画の立てやすさ向上

## 2. URL設計

### パス
```
/calendar
```

### クエリパラメータ
```
?month=YYYY-MM
```

**例**:
- `/calendar` → 現在月を表示
- `/calendar?month=2026-03` → 2026年3月を表示
- `/calendar?month=2026-08` → 2026年8月を表示

**仕様**:
- `month` パラメータ省略時は現在月（2026年2月）を表示
- 無効な形式の場合は現在月にフォールバック
- URLパラメータは Next.js の useSearchParams で取得

## 3. 画面構成

### 3.1 レイアウト構造

```
┌─────────────────────────────────────┐
│ Header (ロゴ + ナビゲーション)        │
├─────────────────────────────────────┤
│ 月ナビゲーション                      │
│  ← 2026年3月 →  | 今月に戻る          │
├─────────────────────────────────────┤
│ カレンダーグリッド (7列×最大6行)      │
│  日 月 火 水 木 金 土                 │
│  25 26 27 28 29  1  2               │
│   3  4  5  6  7  8  9               │
│  10 11 12 13 14 15 16               │
│  17 18 19 20 21 22 23               │
│  24 25 26 27 28 29 30               │
│  31  1  2  3  4  5  6               │
├─────────────────────────────────────┤
│ 選択した日のイベント一覧パネル         │
│  ・イベントカード (再利用)             │
│  ・イベントがない場合の空状態表示       │
└─────────────────────────────────────┘
```

### 3.2 月ナビゲーション

**要素**:
- 前月ボタン (`←`)
- 現在表示中の年月 (`2026年3月`)
- 次月ボタン (`→`)
- 今月に戻るボタン

**動作**:
- 前月/次月ボタン: URLパラメータを更新してページ遷移
- 今月に戻る: パラメータなしの `/calendar` に遷移

### 3.3 カレンダーグリッド

**構造**:
- 7列 (日〜土) × 最大6行
- 前月・次月の日付もグレーアウトで表示
- 今日の日付は視覚的に強調（背景色）

**日付セル**:
- 日付番号 (1〜31)
- イベント数インジケーター:
  - 0件: なし
  - 1-2件: 青ドット（●）
  - 3件以上: 数字バッジ（例: `3+`）
- クリック可能な領域全体

**状態表示**:
- 通常の日: 白背景
- 今日: 青背景（淡い）
- 選択中の日: 青枠
- 前月/次月の日: グレーアウト
- イベントがある日: ドット/バッジ表示

### 3.4 イベント一覧パネル

**表示条件**:
- 日付セルをクリックした時に表示
- 初期状態: 非表示 or 今日の日付が選択状態

**内容**:
- ヘッダー: 「2026年3月15日のイベント (3件)」
- イベントリスト: 既存の `EventCard` コンポーネントを再利用
- 空状態: 「この日のイベントはありません」メッセージ

**ソート順**:
- 開始時刻の早い順

## 4. インタラクション

### 4.1 日付セルクリック

```
ユーザーアクション: 日付セルをクリック
↓
状態更新: 選択日付を更新
↓
表示更新: イベント一覧パネルにその日のイベントを表示
```

### 4.2 イベントカードクリック

```
ユーザーアクション: イベントカードをクリック
↓
ページ遷移: /events/[slug] に遷移
```

### 4.3 月ナビゲーション

```
ユーザーアクション: 前月/次月ボタンをクリック
↓
URL更新: ?month=YYYY-MM を更新
↓
ページ遷移: カレンダーが更新される
```

## 5. データ要件

### 5.1 必要なデータ

```typescript
// 表示月のイベントデータ
type CalendarEvent = {
  id: string;
  slug: string;
  title: string;
  start_date: string; // ISO 8601形式
  // ... その他EventCardで必要なフィールド
};

// 日付ごとのイベントマップ
type EventsByDate = Record<string, CalendarEvent[]>;
// 例: { '2026-03-15': [...], '2026-03-22': [...] }
```

### 5.2 データ取得

- Supabaseから対象月のイベントを取得（start_date でフィルタ）
- Server Componentでデータフェッチ
- 日付でグルーピング処理

```sql
-- 例: 2026年3月のイベント取得
SELECT * FROM events
WHERE start_date >= '2026-03-01'
  AND start_date < '2026-04-01'
ORDER BY start_date ASC;
```

## 6. レスポンシブ対応

### 6.1 デスクトップ (768px以上)

- カレンダーグリッド: 7列×6行のフル表示
- イベント一覧パネル: カレンダーの下部に表示
- 日付セルサイズ: 十分な高さ（ドット/バッジ表示可能）

### 6.2 モバイル (768px未満)

- カレンダーグリッド: 7列×6行（縮小版）
- 日付セルサイズ: 最小限（タップ可能な大きさ確保）
- イベント数インジケーター: ドット/バッジは省略可
- イベント一覧パネル: カレンダーの下部、全幅表示
- スクロール可能

## 7. ヘッダー変更

### 7.1 ナビゲーションリンク追加

**現在**:
```tsx
<nav>
  <Link href="/events">イベント一覧</Link>
</nav>
```

**変更後**:
```tsx
<nav className="flex gap-6">
  <Link href="/events">イベント一覧</Link>
  <Link href="/calendar">カレンダー</Link>
</nav>
```

**スタイル**:
- 同じスタイル適用（text-sm font-medium）
- ホバー効果あり
- アクティブページの視覚的フィードバック（オプション）

## 8. Phase 1 対象範囲

### 含まれる機能
- ✅ 月別カレンダー表示
- ✅ 月ナビゲーション（前月/次月/今月）
- ✅ 日付セルクリック → イベント一覧表示
- ✅ イベントカードクリック → 詳細ページ遷移
- ✅ イベント数インジケーター（ドット/バッジ）
- ✅ レスポンシブ対応
- ✅ ヘッダーにカレンダーリンク追加

### 含まれない機能（Phase 2以降）
- ❌ フィルタリング機能との連携
- ❌ 週表示・日表示ビュー
- ❌ カレンダーへのイベント追加（.ics ダウンロード）
- ❌ イベントの色分け（カテゴリ別など）
- ❌ カレンダー上のイベントホバープレビュー

## 9. 技術スタック

### フロントエンド
- **フレームワーク**: Next.js 16 App Router
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS 4
- **日付処理**: date-fns

### コンポーネント構成
```
app/
  calendar/
    page.tsx                  # カレンダーページ (Server Component)

components/
  calendar/
    CalendarGrid.tsx          # カレンダーグリッド (Client Component)
    CalendarNavigation.tsx    # 月ナビゲーション (Client Component)
    DateCell.tsx              # 日付セル (Client Component)
    EventsPanel.tsx           # イベント一覧パネル (Client Component)
```

### 状態管理
- URL State: 表示月 (`useSearchParams`)
- Client State: 選択日 (`useState`)
- Server Data: イベントデータ（Supabaseから取得）

## 10. 実装優先順位

1. **高**: カレンダーグリッドの表示（日付配置）
2. **高**: イベントデータの日付別グルーピング
3. **高**: 日付セルクリック → イベント一覧表示
4. **中**: 月ナビゲーション
5. **中**: イベント数インジケーター
6. **低**: レスポンシブ最適化
7. **低**: アニメーション・トランジション

## 11. 品質基準

### パフォーマンス
- カレンダー描画: 初回ロード 200ms 以内
- 月切り替え: 100ms 以内

### アクセシビリティ
- キーボード操作可能（矢印キーで日付移動）
- セマンティックHTML使用
- ARIA属性適切に設定

### ユーザビリティ
- 今日の日付が一目でわかる
- イベントがある日が明確
- クリック可能な要素が明確

---

**作成日**: 2026-02-16
**対象Phase**: Phase 1 (MVP)
**次のステップ**: UIデザイン設計・コンポーネント設計 (Task #2)
